/**
 * @author			Julian Bogdani <jbogdani@gmail.com>
 * @copyright		BraDypUS, Julian Bogdani <jbogdani@gmail.com>
 * @license			See file LICENSE distributed with this code
 */
var vocabularies={init:function(){core.open({obj:"vocabularies_ctrl",method:"list",title:core.tr("vocabulary_mng"),loaded:t=>{t.find(".sortable").each(((t,e)=>{new Sortable(e,{animation:150,ghostClass:"active",onEnd:function(t){const e=this.toArray();core.runAndRespond("vocabularies_ctrl","sort",{sort:e})}})})),t.find("a.voc").on("click",(function(){$(this).parents("li").find("a").toggleClass("active"),$(this).next("ul").toggle()})),t.find(".edit_def").on("click",(function(){var t=$(this).parents("li:eq(0)");vocabularies.edit(t.data("id"),t.data("text"),(function(e){t.data("text",e),t.find(".def").text(e)}))})),t.find(".delete_def").on("click",(function(){var t=$(this).parents("li:eq(0)");vocabularies.erase(t.data("id"),(function(){1===t.siblings().length?t.parent("ul").parent("li").remove():t.remove()}))})),t.find(".add_voc").on("click",(t=>{vocabularies.add_new(t.target.closest("[data-voc]")?t.target.closest("[data-voc]").dataset.voc:"",(()=>layout.tabs.reloadActive()))}))}})},edit:function(t,e,o){var a=`<input value="${e}" type="text" class="form-control">`;core.open({title:core.tr("edit_def"),html:a,buttons:[{text:core.tr("save"),click:function(){var e=$("#modal input").val();core.getJSON("vocabularies_ctrl","edit",{id:t,val:e},!1,(function(t){core.message(t.text,t.status),"success"===t.status&&o&&o(e)})),$("#modal").modal("hide")}},{text:core.tr("close"),action:"close"}]},"modal")},erase:function(t,e){core.open({title:core.tr("attention"),html:'<h3 class="text-error">'+core.tr("confirm_delete_def")+"</h3>",buttons:[{text:core.tr("erase"),click:function(){core.getJSON("vocabularies_ctrl","erase",{id:t},!1,(function(t){core.message(t.text,t.status),"success"==t.status&&e&&e()})),$("#modal").modal("hide")}},{text:core.tr("close"),action:"close"}]},"modal")},add_new:function(t,e){core.open({title:core.tr(t?"new_def":"new_voc"),obj:"vocabularies_ctrl",method:"add_new_form",param:{voc:t},buttons:[{text:core.tr("add"),click:function(){var t=$("#voc").val(),o=$("#def").val();t&&o?core.getJSON("vocabularies_ctrl","add",{voc:t,def:o},!1,(function(t){"success"===t.status&&($("#def").val(""),e&&e()),core.message(t.text,t.status)})):core.message(core.tr("voc_def_required"),"error")}},{text:core.tr("close"),action:"close"}]},"modal")}};