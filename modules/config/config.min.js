/**
 * @author			Julian Bogdani <jbogdani@gmail.com>
 * @copyright		BraDypUS, Julian Bogdani <jbogdani@gmail.com>
 * @license			See file LICENSE distributed with this code
 */
var config={init:function(){api.confirmSuperAdmPwd((e=>{core.open({title:core.tr("sys_config"),obj:"config_ctrl",method:"home"})}))},validateApp:e=>{core.getHTML("config_ctrl","validate_app",!1,!1,(t=>{$("#"+e+" .edit-column").html(t),$("#"+e+" .field-list-column").html("").removeClass("col-sm-3")}))},viewAppProperties:e=>{core.getHTML("config_ctrl","app_properties",!1,!1,(t=>{$("#"+e+" .edit-column").html(t),$("#"+e+" .field-list-column").html("").removeClass("col-sm-3")}))},viewTbProperties:function(e,t){core.getHTML("config_ctrl","table_properties",!!e&&{tb:e},!1,(e=>{$("#"+t+" .edit-column").html(e),$("#"+t+" .field-list-column").html("").removeClass("col-sm-3")}))},viewFldList:function(e,t){core.getHTML("config_ctrl","fld_list",{tb:e},!1,(e=>{$("#"+t+" .field-list-column").html(e),$("#"+t+" .field-list-column").addClass("col-sm-3"),$("#"+t+" .edit-column").html("")}))},viewFldProperties:function(e,t,o){const c=$(o).parents(".main").children(".edit-column");let r={tb:e};t&&(r.fld=t),core.getHTML("config_ctrl","field_properties",r,!1,(e=>{c.html(e)}))},saveTbData:function(e,t){core.getJSON("config_ctrl","save_tb_data",!1,e.serializeArray(),(function(e){core.message(e.text,e.status),"success"===e.status&&config.viewTbProperties(t,$("div.active .config_container").attr("id"))}))},addNewTb:function(e){core.getJSON("config_ctrl","add_new_tb",!1,e.serializeArray(),(function(e){core.message(e.text,e.status),"success"===e.status&&(layout.tabs.reloadActive(),setTimeout((()=>{config.viewTbProperties(e.tb,$("div.active .config_container").attr("id"))}),500))}))},saveFldProperties:(e,t,o)=>{core.getJSON("config_ctrl","save_fld_properties",!1,e.serializeArray(),(function(c){core.message(c.text,c.status),"success"===c.status&&config.viewFldProperties(t,o,e)}))},addNewFld:(e,t)=>{core.getJSON("config_ctrl","add_new_fld",!1,e.serializeArray(),(function(o){core.message(o.text,o.status),"success"===o.status&&(config.viewFldProperties(t,o.fld,e),config.viewFldList(t,e.parents(".config_container").attr("id")))}))},saveAppProperties:e=>{core.getJSON("config_ctrl","save_app_properties",!1,e.serializeArray(),(function(e){core.message(e.text,e.status)}))},deleteTb:e=>{core.open({title:core.tr("delete_table"),html:'<p class="lead">'+core.tr("warning_delete_table")+"</p>",buttons:[{text:core.tr("close"),action:"close"},{addclass:"btn-danger",text:core.tr("delete_table"),click:function(){core.getJSON("config_ctrl","delete_tb",{tb:e},!1,(e=>{$("#modal").modal("hide"),core.message(e.text,e.status),layout.tabs.reloadActive()}))}}]},"modal")},deleteColumn:(e,t,o)=>{core.open({title:core.tr("delete_column"),html:'<p class="lead">'+core.tr("warning_delete_column")+"</p>",buttons:[{text:core.tr("close"),action:"close"},{addclass:"btn-danger",text:core.tr("delete_column"),click:function(){core.getJSON("config_ctrl","delete_column",{tb:e,fld:t},!1,(t=>{$("#modal").modal("hide"),core.message(t.text,t.status),config.viewFldList(e,$(o).parents(".config_container").attr("id"))}))}}]},"modal")},renameTb:e=>{core.open({title:core.tr("rename_table"),html:`<p class="lead text-danger">\n\t\t\t\t${core.tr("warning_rename_table")}\n\t\t\t</p>\n\t\t\t<hr>\n\t\t\t<input type="text" class="form-control new-tb-name" value="${e}">`,buttons:[{text:core.tr("close"),action:"close"},{addclass:"btn-danger",text:core.tr("rename_table"),click:function(){const t=$("#modal input.new-tb-name").val();core.getJSON("config_ctrl","rename_tb",{old_name:e,new_name:t},!1,(e=>{$("#modal").modal("hide"),core.message(e.text,e.status),"success"===e.status&&layout.tabs.reloadActive()}))}}]},"modal")},renameFld:(e,t,o)=>{core.open({title:core.tr("rename_column"),html:`<p class="lead text-danger">${core.tr("warning_rename_column")}</p><hr><input type="text" class="form-control new-column-name" value="${t}">`,buttons:[{text:core.tr("close"),action:"close"},{addclass:"btn-danger",text:core.tr("rename_column"),click:function(){const c=$("#modal input.new-column-name").val();core.getJSON("config_ctrl","rename_column",{tb:e,old_name:t,new_name:c},!1,(t=>{$("#modal").modal("hide"),core.message(t.text,t.status),"success"===t.status&&($("#modal").modal("hide"),core.message(t.text,t.status),config.viewFldList(e,$(o).parents(".config_container").attr("id")))}))}}]},"modal")},fix:(e,t,o,c)=>{core.runAndRespond("config_ctrl","fix",{action:t,tb:o,col:c||null},!1,(t=>{"success"===t.status&&$(e).parent().remove()}))},setFldOptions:(e,t)=>{core.getJSON("config_ctrl","getFldList",{tb:e},!1,(e=>{const o=e.fields;$(t).find("option").remove();for(const[e,c]of Object.entries(o))$(t).append(`<option value="${e}">${c}</option>`)}))},viewGeoFaceProperties:e=>{core.getHTML("config_ctrl","geoface_properties",!1,!1,(t=>{$("#"+e+" .edit-column").html(t),$("#"+e+" .field-list-column").html("").removeClass("col-sm-3")}))},saveGeoFaceProperties:(e,t)=>{core.getJSON("config_ctrl","save_geoface_properties",!1,e.serializeArray(),(function(t){core.message(t.text,t.status),"success"===t.status&&config.viewGeoFaceProperties(e.parents(".config_container").attr("id"))}))},deleteGeoFile:(e,t)=>{core.open({title:core.tr("delete")+" "+e,html:core.tr("confirm_delete_geofile",[e]),buttons:[{text:"Delete",addclass:"btn btn-danger",click:o=>{core.getJSON("config_ctrl","delete_local_geofile",{file:e},!1,(function(e){core.message(e.text,e.status),o.modal("hide"),"success"===e.status&&config.viewGeoFaceProperties(t.parents(".config_container").attr("id"))}))}},{text:core.tr("cancel"),click:"close"}]},"modal")}};